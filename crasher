local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local active = false
local guiVisible = true
local connections = {}

pcall(function()
    StarterGui:SetCore("SendNotification", {
        Title = ".resort";
        Text = "ready (ctrl to toggle)";
        Duration = 3;
    })
end)

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ResortGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 180, 0, 80)
MainFrame.Position = UDim2.new(0.5, -90, 0.1, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

local DragBorder = Instance.new("Frame")
DragBorder.Name = "DragBorder"
DragBorder.Size = UDim2.new(1, 0, 0, 25)
DragBorder.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
DragBorder.BorderSizePixel = 0
DragBorder.Parent = MainFrame

local DragCorner = Instance.new("UICorner")
DragCorner.CornerRadius = UDim.new(0, 10)
DragCorner.Parent = DragBorder

local DragFix = Instance.new("Frame")
DragFix.Size = UDim2.new(1, 0, 0, 13)
DragFix.Position = UDim2.new(0, 0, 0, 12)
DragFix.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
DragFix.BorderSizePixel = 0
DragFix.Parent = DragBorder

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = ".resort"
Title.TextColor3 = Color3.fromRGB(255, 70, 70)
Title.TextSize = 14
Title.Font = Enum.Font.GothamBold
Title.Parent = DragBorder

local ResortButton = Instance.new("TextButton")
ResortButton.Name = "ResortButton"
ResortButton.Size = UDim2.new(1, -20, 0, 40)
ResortButton.Position = UDim2.new(0, 10, 0, 30)
ResortButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ResortButton.Text = "start"
ResortButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResortButton.TextSize = 16
ResortButton.Font = Enum.Font.GothamBold
ResortButton.BorderSizePixel = 0
ResortButton.Parent = MainFrame

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 8)
ButtonCorner.Parent = ResortButton

local function stopResort()
    for _, conn in pairs(connections) do
        conn:Disconnect()
    end
    connections = {}
    active = false
    ResortButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    ResortButton.Text = "start"
    
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = ".resort";
            Text = "stopped";
            Duration = 2;
        })
    end)
end

local function startResort()
    active = true
    ResortButton.BackgroundColor3 = Color3.fromRGB(60, 100, 60)
    ResortButton.Text = "running"
    
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = "Resort";
            Text = "started";
            Duration = 2;
        })
    end)
    
    for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
        if remote:IsA("RemoteEvent") then
            local conn = RunService.Heartbeat:Connect(function()
                for i = 1, 500 do
                    pcall(function()
                        remote:FireServer(math.random(), math.random(), math.random())
                    end)
                end
            end)
            table.insert(connections, conn)
        end
    end
end

ResortButton.MouseButton1Click:Connect(function()
    if not active then
        startResort()
    else
        stopResort()
    end
end)

ResortButton.MouseEnter:Connect(function()
    if not active then
        ResortButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end
end)

ResortButton.MouseLeave:Connect(function()
    if not active then
        ResortButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end
end)

-- Dragging functionality
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

DragBorder.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

DragBorder.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Ctrl to hide/show
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.LeftControl then
        guiVisible = not guiVisible
        MainFrame.Visible = guiVisible
    end
end)

ScreenGui.Parent = game:GetService("CoreGui")

LocalPlayer.Chatted:Connect(function(msg)
    if msg:lower() == ".resort" then
        if not active then
            startResort()
        else
            stopResort()
        end
    end
end)
